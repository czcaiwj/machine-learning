# 神经网络模型的计算

## 一、例子

![神经网络模型的计算](神经网络模型的计算.assets/神经网络模型的计算.png)

设提供的训练样本输入值为$(x_1=0.05, x_2=0.1)$，输出值为$(y_1=1, y_2=0)$。

第一层到第二层的各节点权重系数$\Theta^{(1)}$如下：
$$
\begin{align*}
\theta^{(1)}_{1,0}&=-0.37,&\theta^{(1)}_{1,1}&=0.14,&\theta^{(1)}_{1,2}&=-0.06\\
\theta^{(1)}_{2,0}&=0.15,&\theta^{(1)}_{2,1}&=0.2,&\theta^{(1)}_{2,2}&=0.4\\
\end{align*}
$$
第二层到第三层的各节点权重系数$\Theta^{(2)}$如下：
$$
\begin{align*}
\theta^{(2)}_{1,0}&=0.07,&\theta^{(2)}_{1,1}&=0.29,&\theta^{(2)}_{1,2}&=0.33\\
\theta^{(2)}_{2,0}&=0.1,&\theta^{(2)}_{2,1}&=-0.27,&\theta^{(2)}_{2,2}&=0.5\\
\end{align*}
$$
一开始上述的权重系数都是随机选择的，选取策略为：
$$
\Theta=rand(0,1)*2\epsilon-\epsilon
$$
这样权重系数会落在$(-\epsilon,\epsilon)$之间。

我们的目标是，通过选择恰当的权重系数，使得输入值$(x_1, x_2)$经过神经网络的计算，输出一个接近样本输出值$(y_1,y_2)$的结果值。

## 二、前向传播计算各层的值

### 2.1 输入层到隐藏层

$$
\begin{align*}
z^{(2)}_1&=\theta^{(1)}_{1,0}*a^{(1)}_0+\theta^{(1)}_{1,1}*a^{(1)}_1+\theta^{(1)}_{1,2}*a^{(1)}_2\\
&=-0.37\times1+0.14\times0.05+(-0.06)\times0.1\\
&=-0.369
\newline\newline
z^{(2)}_2&=\theta^{(1)}_{2,0}*a^{(1)}_0+\theta^{(1)}_{2,1}*a^{(1)}_1+\theta^{(1)}_{2,2}*a^{(1)}_2\\
&=0.15\times1+0.2\times0.05+0.4\times0.1\\
&=0.2
\end{align*}
$$

此处激活函数$g$为$Sigmoid$函数，即$g(x)=\frac{1}{1+e^{-x}}$。
$$
\begin{align*}
a^{(2)}_1=g(z^{(2)}_1)=\frac{1}{1+e^{-z^{(2)}_1}}=\frac{1}{1+e^{0.369}}=0.408782679\\
a^{(2)}_2=g(z^{(2)}_2)=\frac{1}{1+e^{-z^{(2)}_2}}=\frac{1}{1+e^{-0.2}}=0.549833997\\
\end{align*}
$$

### 2.2 隐藏层到输出层

$$
\begin{align*}
z^{(3)}_1&=\theta^{(2)}_{1,0}*a^{(2)}_0+\theta^{(2)}_{1,1}*a^{(2)}_1+\theta^{(2)}_{1,2}*a^{(2)}_2\\
&=0.07\times1+0.29\times0.408782679+0.33\times0.549833997\\
&=0.369992196
\newline\newline
z^{(3)}_2&=\theta^{(2)}_{2,0}*a^{(2)}_0+\theta^{(2)}_{2,1}*a^{(2)}_1+\theta^{(2)}_{2,2}*a^{(2)}_2\\
&=0.1\times1+(-0.27)\times0.408782679+0.5\times0.549833997\\
&=0.264545675
\newline\newline
a^{(3)}_1&=g(z^{(3)}_1)=\frac{1}{1+e^{-z^{(3)}_1}}=\frac{1}{1+e^{-0.369992196}}=0.591457093\\
a^{(3)}_2&=g(z^{(3)}_2)=\frac{1}{1+e^{-z^{(3)}_2}}=\frac{1}{1+e^{-0.264545675}}=0.565753389\\
\end{align*}
$$

此时，前向传播的过程就完成了，我们得到输出值为$[0.591457093, 0.565753389]$，该值和样本值$[1, 0]$相差甚远，所以我们要对误差进行反向传播，来更新权重系数，以便输出结果更接近样本输出值。

## 三、误差的表示

由于我们随机初始化了权重系数，因此得出的结果与样本结果相差甚远，那么每个输出节点$a^{(L)}_i$与样本输出值$y_i$之间的差距就是该输出节点的误差。我们用$\delta^{(l)}$来表示。
$$
\delta^{(l)}_i=a^{(l)}_i-y_i
$$
模型的总误差等于各个输出节点的误差的平方和除以2。
$$
\Delta^{(l)}=\frac{1}{2}\sum_{i=1}^n(a^{(l)}_i-y_i)^2
$$
那么经过一轮前向传播后得到的结果误差分别是：
$$
\begin{align*}
\delta^{(3)}_1&=a_1^{(3)}-y_1=0.591457093-1=-0.408542907\\
\delta^{(3)}_2&=a_2^{(3)}-y_2=0.565753389-0=0.565753389
\end{align*}
$$
总误差是：
$$
\begin{align*}
\Delta^{(3)}&=\frac{1}{2}((-0.408542907)^2+0.565753389^2)\\&=\frac{1}{2}(0.166907307+0.320076898)\\&=0.243492102
\end{align*}
$$

## 四、反向传播

### 4.1 隐藏层到输出层的权重更新

